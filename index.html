<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>BC hiking pass</title>

    <!-- Bootstrap core CSS -->
    <link href="dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="form-validation.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
  </head>

  <body style="background-color: #f8f9fa!important;font-family:sans-serif">

    <div class="container">
      <div id="page-title" class="text-center">
        <h2>BC hiking pass script</h2>
        <div class="lead" style="color:red">Note: This process is tricky and requires practice, do not try to do this the morning of.</div>
        <div class="lead" style="color:red">P.S. This does not work on a mobile device, PCs and laptops only</div>
      </div>

      <div class="row">
        <div class="col-md-12 order-md-1">
          <h4 class="mb-3">Step 1: Fill in the fields and generate code</h4>
          <form class="needs-validation" onsubmit="generatecode(event)">
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="parklist">Park</label>
                <select class="custom-select d-block w-100" id="parklist" onchange="changeParks()">
                  <option value="0">South Coast - Garibaldi Park</option>
                  <option value="1">South Coast - Golden Ears Park</option>
                  <option value="4">South Coast - Joffre Lakes Park</option>
                  <option value="2">Northern - Mount Robson Park</option>
                  <option value="3">South Coast - Stawamus Chief Park</option>
                  <option value="4">South Coast - Mount Seymour Park</option>
                  <option value="5">South Coast - Cypress Provincial Park</option>
                </select>
                <div class="invalid-feedback">
                  Please select a park.
                </div>
              </div>
              <div class="col-md-5 mb-3">
                <label for="traillist">Trail</label>
                <select class="custom-select d-block w-100" id="traillist" onchange="changeTrails()">
                  <option value = '1'>Diamond Head Trailhead - ALL DAY - Vehicle</option>
                  <option value = '2'>Rubble Creek Trailhead - ALL DAY - Vehicle</option>
                </select>
                <div class = 'invalid-feedback'>
                  Please select a trail.
                </div>
              </div>
              <div class = 'col-md-3 mb-3'>
                <label for="numofpasses">Number of Passes</label>
                <input type="number" class="form-control" id="numofpasses" value="1" min="1" required="" disabled>
                <div class="invalid-feedback">
                  Number of passes required.
                </div>
              </div>
            </div>
            <button class="btn btn-primary btn-lg btn-block" type="submit">Generate code</button>
            <div id="copiedSuccess">Copied to clipboard!</div>
          </form>
          <div class="codeblock" id="generatedCode" style="display:none;">
              <code>
              <div>setTimeout(function(){ $.ajax({</div>
              <div>&emsp;&emsp;type: "POST",</div>
              <div>&emsp;&emsp;url: 'https://discovercamping.ca/BCCWeb/Memberships/MembershipPasses.aspx/MembershipAddToCart',</div>
              <div id="postData">&emsp;&emsp;data: '{"data":{"membershipId":<span id="membershipId"></span>,"qty":<span id="passQty"></span>,"passType":<span id="passType"></span>,"placeId": <span id="passPlaceId"></span>}}',</div>
              <div>&emsp;&emsp;contentType: "application/json; charset=utf-8",</div>
              <div>&emsp;&emsp;dataType: "json",</div>
              <div>&emsp;&emsp;success: function(response){window.location.replace('https://discovercamping.ca/BCCWeb/Customers/ShoppingCart.aspx')}</div>
              <div id="postDate">});}, new Date('<span id='checkoutDate'></span> 7:00:01') - new Date()); </div>                    
          </code>         
          </div>
          <h4 class="mb-3">Step 2</h4>
          <div>Go to <a href='https://discovercamping.ca/BCCWeb/Memberships/MembershipPasses.aspx ' target="_blank">The BC hiking pass reservation website </a></div>
          <div>And sign in <span class="font-weight-bold">AFTER</span> 6:55 am</div>
          <br>
          <h4 class="mb-3">Step 3</h4>
          <div>Open developer tools on the BC hiking reservation site and paste the generated code into the console</div>
          <div id="accordion">
            <div class="card">
              <div class="card-header" id="headingOne">
                <h5 class="mb-0">
                  <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    Click here to learn how
                  </button>
                </h5>
              </div>
              <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                <div class="card-body">
                  <img id = "howToGif" src="developer_console.gif">
                </div>
              </div>
            </div>
          </div>
          <br>
          <h4 class="mb-3">Step 4</h4>
          <div>Left click in the developer console and press enter</div>
          <div class="d-flex align-items-center">You will be automatically directed to the checkout page at 7:00 am </div>
          <img style = "height:30px"src="https://altcodeunicode.com/wp-content/uploads/2020/01/partying-face-emoji-1f973-google-android.png">
        </div>
      </div>


    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script>
        var trails = [
            [
                {name:'Diamond Head Trailhead - ALL DAY - Vehicle', membershipId:'1657', placeId:'41', passType:'2'},
                {name:'Rubble Creek Trailhead - ALL DAY - Vehicle', membershipId:'1658', placeId:'41', passType:'2'}
            ],
            [
                {name:'Alouette Lake (South beach) - AM PASS - Vehicle', membershipId:'1652', placeId:'43', passType:'1'},
                {name:'Alouette Lake (South beach) - PM PASS - Vehicle', membershipId:'1653', placeId:'43', passType:'1'},
                {name:'Boat launch - ALL DAY - Vehicle', membershipId:'1647', placeId:'43', passType:'1'},
                {name:'East Canyon Trail, Lower Falls and Gold Creek - AM PASS - Vehicle', membershipId:'1648', placeId:'43', passType:'1'},
                {name:'East Canyon Trail, Lower Falls and Gold Creek - PM PASS - Vehicle', membershipId:'1649', placeId:'43', passType:'1'},
                {name:'West Canyon Trail Parking - AM PASS - Vehicle', membershipId:'1650', placeId:'43', passType:'1'},
                {name:'West Canyon Trail Parking - PM PASS - Vehicle', membershipId:'1651', placeId:'43', passType:'1'}
            ],
            [
                {name:'Joffre Lakes - ALL DAY - Person', membershipId:'1654', placeId:'54', passType:'2'}
            ],
            [
                {name:'Berg Lake Trail – AM - Vehicle', membershipId:'1661', placeId:'87', passType:'2'},
                {name:'Berg Lake Trail – PM - Vehicle', membershipId:'1662', placeId:'87', passType:'2'}
            ],
            [
                {name:'Chief Peaks Trail only – AM - Person', membershipId:'1655', placeId:'129', passType:'2'},
                {name:'Chief Peaks Trail only – PM - Person', membershipId:'1656', placeId:'129', passType:'2'}
            ],
            [
                {name:'Upper Mountain Trails – AM - Person', membershipId:'1624', placeId:'156', passType:'2'},
                {name:'Upper Mountain Trails – PM - Person', membershipId:'1625', placeId:'156', passType:'2'}
            ],
            [
                {name:'Black Mountain Plateau Trails – AM - Person', membershipId:'1622', placeId:'171', passType:'2'},
                {name:'Black Mountain Plateau Trails – PM - Person', membershipId:'1623', placeId:'171', passType:'2'},
                {name:'Hollyburn Trail – AM - Person', membershipId:'1620', placeId:'171', passType:'2'},
                {name:'Hollyburn Trail – PM - Person', membershipId:'1621', placeId:'171', passType:'2'},
                {name:'Howe Sound Crest Trail – AM - Person', membershipId:'1618', placeId:'171', passType:'2'},
                {name:'Howe Sound Crest Trail – PM - Person', membershipId:'1619', placeId:'171', passType:'2'}
            ]
        ];

        function changeParks(){
            //clear trail options
            var select = document.getElementById("traillist");
            var length = select.options.length;
            for (i = length-1; i >= 0; i--) {
                select.options[i] = null;
            }
            var e = document.getElementById("parklist");
            var parknum = e.options[e.selectedIndex].value;
            var select = document.getElementById("traillist"); 

            for(var i = 0; i < trails[parknum].length; i++) {
                let opt = trails[parknum][i];
                let el = document.createElement("option");
                el.textContent = opt.name;
                el.value = i;
                select.appendChild(el);
            }
            changeTrails();
        }

        function changeTrails(){
            //clear trail options
            var sel = document.getElementById("traillist");
            var selectedTrail = sel.options[sel.selectedIndex].text;
            if(selectedTrail.includes('Vehicle')){
                document.getElementById('numofpasses').value = 1;
                document.getElementById('numofpasses').disabled = true;
            }
            else if(selectedTrail.includes('Person')){
              document.getElementById('numofpasses').disabled = false;
            }
        }

        function generatecode(e){
            e.preventDefault();
            let parkDropdown = document.getElementById("parklist");
            let selectedParkIndex = parkDropdown.options[parkDropdown.selectedIndex].value;
            let trailDropdown = document.getElementById("traillist");
            let selectedTrailIndex = trailDropdown.options[trailDropdown.selectedIndex].value;

            let membershipId =  trails[selectedParkIndex][selectedTrailIndex].membershipId;
            let passPlaceId = trails[selectedParkIndex][selectedTrailIndex].placeId;
            let passType = trails[selectedParkIndex][selectedTrailIndex].passType;
            let passQty = document.getElementById('numofpasses').value;
            let checkoutDate = (new Date()).toISOString().slice(0, 10);
            document.getElementById('membershipId').textContent = membershipId;
            document.getElementById('passPlaceId').textContent = passPlaceId;
            document.getElementById('passType').textContent = passType;
            document.getElementById('passQty').textContent = passQty;
            document.getElementById('checkoutDate').textContent = checkoutDate;
            
            let code = 
            `setTimeout(function(){ $.ajax({
  type: "POST",
  url: 'https://discovercamping.ca/BCCWeb/Memberships/MembershipPasses.aspx/MembershipAddToCart',
  data: '{"data":{"membershipId":${membershipId},"qty": ${passQty},"passType": ${passType},"placeId": ${passPlaceId}}}',
  contentType: "application/json; charset=utf-8",
  dataType: "json",
  success: function(response){window.location.replace('https://discovercamping.ca/BCCWeb/Customers/ShoppingCart.aspx')}
});}, new Date('${checkoutDate} 7:00:01') - new Date());`
            copyToClipboard(code)

            document.getElementById('copiedSuccess').style.display = 'block';
            document.getElementById('generatedCode').style.display = 'block';
        }

        function copyToClipboard(text) {
            var dummy = document.createElement("textarea");
            // to avoid breaking orgain page when copying more words
            // cant copy when adding below this code
            // dummy.style.display = 'none'
            document.body.appendChild(dummy);
            //Be careful if you use texarea. setAttribute('value', value), which works with "input" does not work with "textarea". – Eduard
            dummy.value = text;
            dummy.select();
            document.execCommand("copy");
            document.body.removeChild(dummy);
        }
    </script>
  
  <footer class="text-muted text-center text-small">
    <p class="mb-1">© 2020-2020 Michael Liu</p>
  </footer>
</body></html>